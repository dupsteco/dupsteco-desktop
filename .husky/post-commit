#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

PREV_V=$(cd release/app && npm pkg get version | sed 's/"//g')

exec < /dev/tty

node "$(dirname -- "$0")"/bump-version.js

NEW_V=$(cd release/app && npm pkg get version | sed 's/"//g')

if [ $PREV_V == $NEW_V ]
then
  echo "\nNothing was bumped!"
else
  echo "\nDisabling post-commit before commiting.."
  chmod -x .husky/hooks/post-commit
  echo "\nCommiting.."
  git commit -m "chore: bump package version to $NEW_V"
  echo "\nEnabling post-commit.."
  chmod +x .husky/hooks/post-commit
  echo "\nBumping tag..."
  git tag v$NEW_V
  echo "\nPushing.."
  git push && git push --tags
  echo "Done!"
fi
